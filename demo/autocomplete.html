<!DOCTYPE html>
<html>
<head lang="en">

    <meta charset="UTF-8">
    <title></title>

    <link href="demo.css" rel="stylesheet" type="text/css" />

    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.11.1/typeahead.jquery.min.js"></script>
    <script src="../dist/FuzzySearch.min.js"></script>
    <script src="../dist/Highlight.FS.min.js"></script>


</head>
<body>


<h1>FuzzySearch Demo</h1>

<p>Demo page for <a href="https://github.com/jeancroy/FuzzySearch">FuzzySearch Suggestion engine</a>. </p>
<p>Want a minimal setup demo? it's  <a href="https://rawgit.com/jeancroy/FuzzySearch/master/demo/simple.html">here</a>. </p>

<h2>Dataset</h2>

<p>
    <form>
        <label><input type="radio" name="source" value="small" checked/> Small book dataset, <a href="books.json">about
            2kb</a> </label>
        <label><input type="radio" name="source" value="large"/> Large book dataset, <a href="books_large.json">about
            220kb</a> </label>

        <br><br>
        <label> <input type="checkbox" name="free" id="free" checked /> Enable per token score </label><br>
        <table style="text-align: left; display:block; width:90%; margin:auto; max-width:600px;vertical-align: top;margin-top:0">
            <tr><td><strong>Enable:</strong></td><td>Allow free word order, try to respect word boundary &amp;  match start of words, Different words can match different fields. Friendlier for complete sentences !</td></tr>
            <tr><td><strong>Disable:</strong></td><td>Very fast ! Match whole query against whole field. All character in order, score best field for each item. If your dataset have one word per item, (or one word per field) this might be the best option for you</td></tr>
        </table>

        <br><br>
        <label> <input type="checkbox" name="fused" id="fused" /> Enable fused score </label><br>
        (Test an extra possibility where both string matches without token boundary. eg "oldmanwar" matches "old man war")

    </form>
</p>

<h2>Using Twitter Typeahead</h2>

<div class="typeahead">
    <input id="demo-query" class="twitter-typeahead" name="demo-query" autocomplete="off" type="text">
</div>


<h2>Using Jquery UI Autocomplete</h2>

<div class="typeahead">
    <input id="demo-query-ui-auto" class="twitter-typeahead" name="demo-query-ui-auto" autocomplete="off" type="text">
</div>

<!-- allow to scroll so autocomplete is at top of page -->
<div style="height: 500px;"></div>

<script>

    //
    // Create main object
    // We will fill the data once we have the JSON loaded
    //

    var fuzzyhound = new FuzzySearch({output_limit: 6, output_map:"root"});


    // - - - - - - - - - - - - - - - - - - - - - - -
    //    Item template, shared for both autocompletes
    // - - - - - - - - - - - - - - - - - - - - - - -

    function itemTemplate(suggestion) {

        var item = suggestion.item;
        var query = suggestion._query;
        var author = item.author || item.authors.author;

        if (Object.prototype.toString.call(author) === '[object Array]') {
            author = author.join(", ");
        }

        return [
            "<div>",
            "<span class='title'>\"", fuzzyhound.highlight(item.title), "\"</span>",
            "<span class='author'>  by ", fuzzyhound.highlight(author), "</span>",
            "<span class='score'>(&nbsp;", suggestion.score.toFixed(2), "&nbsp;)</span>",
            "</div>"
        ].join("");

    }

    //
    // Use footer to show some performance stats
    //

    function footerTemplate() {
        var render_end = performance.now();
        return "<div class='typeahead-footer'> " +
                "Search took <strong>" + fuzzyhound.search_time.toFixed(3) + " ms</strong><br>" +
                "Total (search+highlight+render):  <strong>" + (render_end - fuzzyhound.start_time).toFixed(3) + " ms</strong><br>" +
                "Query: <strong>" + fuzzyhound.query.normalized.length + "</strong> chars <br>" +
                "Source contain " + fuzzyhound.source.length + " Items<br>" +
                "</div>";
    }

    //- - - - - - - - - - -
    //   Typeahead Setup
    // - - - - - - - - - - -

    $('#demo-query').typeahead({
                minLength: 2,
                highlight: false //we'll use FuzzySearch highlight instead
            },
            {
                name: 'books',
                limit: 100, // let fuzzyhound apply limit
                source: fuzzyhound,
                display: "item.title",
                templates: {
                    suggestion: itemTemplate,
                    footer: footerTemplate,
                    pending: ""
                }

            }).bind('typeahead:select', function (ev, suggestion) {
                alert('Selection: ' + suggestion.item.title);
            });


    //- - - - - - - - - - --
    //    Jquery UI Auto complete Setup
    // - - - - - - - - - - -

    var $el = $("#demo-query-ui-auto");

        $el.autocomplete({
            minLength: 2,
            delay: 0,
            source: fuzzyhound.$uiSource(),
            messages: {
                noResults: '',
                results: function () {
                }
            }

        });

    //
    // $ui autocomplete do not support template.
    // Instead we have "extension point" which are internal rendering function we can rewrite to achieve the result we want.
    // The plus side is that it give complete control, the bad side is that it get extremely ugly because we mix
    // inner working with our template definition.
    //

    //Get instance of autocomplete widget
    var $instance = $el.autocomplete("instance");

    //Custom item
    $instance._renderItem = function (ul, item) {
        return $("<li>").append(itemTemplate(item)).appendTo(ul);
    };

    //Custom menu, to insert footer
    $instance._renderMenu = function (ul, items) {
        var nbitems = items.length, i = -1;
        while (++i < nbitems) {
            var display = items[i].item.title;
            this._renderItem(ul, items[i])
                    .data("ui-autocomplete-item",
                    {display: display, value: display});
        }
        $("<li>").append(footerTemplate()).data("ui-autocomplete-item", {display: "", value: ""}).appendTo(ul);
    };


    // - - - - - - - - - - - -
    //   Setup dataset switch
    //- - - - - - - - - - - - -

    $.ajaxSetup({cache: true});
    function setsource(url, keys) {
        $.getJSON(url).then(function (response) {
            fuzzyhound.setOptions({
                source: response,
                keys: keys
            })
        });
    }

    //Load small dataset by default
    setsource("books.json", ["title", "author"]);


    // - - - - - - - - - - - -
    //   Dataset switch UI
    //- - - - - - - - - - - - -

    $('input[name=source]:radio').change(function () {

        switch (this.value) {

            case "large":
                setsource("books_large.json", ["title", "authors.author"]);
                break;

            case "small":
            default:
                setsource("books.json", ["title", "author"]);
                break;
        }

    });

    // - - - - - - - - - - - -
    //   Option UI
    //- - - - - - - - - - - - -


    $('#free').change(function () {
        fuzzyhound.setOptions({
            score_per_token: $(this).is(":checked")
        })
    });

    $('#fused').change(function () {
        fuzzyhound.setOptions({
            score_test_fused: $(this).is(":checked")
        });
    })



</script>


</body>
</html>